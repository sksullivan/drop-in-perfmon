<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Violet C:99% M:33%</title>
        <meta name="description" content="An interactive getting started guide for Brackets.">
        <link rel="stylesheet" href="splash.css">
    </head>
    <body>
        <div class="content">
            <h1>PERF: VIOLET</h1>
	    <div id="info-table"><table></table></div>
        </div>
	<div class="right content">
	    <div id="cpu-graph"i class="chart"></div>
	    <div id="mem-graph"i class="chart"></div>
	</div>
        <script src="jquery.js"></script>
        <script>
	const HOST = "violet";
	const sum_stat = function (stats,stat_name) {
	  return stats.map(function (proc_dict) {
            return parseFloat(proc_dict[stat_name]);
          }).reduce(function (prev,curr) {
            return prev+curr;
	  },0);
        };
        const load_data = function () {
          $.get('api/stats?'+$.param({sort: 'cpu%,mem%'})).done(function (stats) {
            stats = JSON.parse(stats);
            $('#info-table table').html(
	      "<thead>"+Object.keys(stats[0]).map(function (col) {
                return "<td>"+col+"</td>";
              }).join('')+
              stats.map(function (proc_dict) {
                return "<tr>"+Object.keys(proc_dict).map(function (key) {
		  return "<td>"+proc_dict[key]+"</td>";
		}).join('')+"</tr>";
              }).join('')+"</table>");
	    console.log(sum_stat(stats,'mem%'));
	    document.title = HOST+" C:"+sum_stat(stats,'cpu%').toFixed(0)+"% M:"+sum_stat(stats,'mem%').toFixed(0)+"%";
            setTimeout(load_data,1000);
          });
	};
        load_data();
        </script>
    </body>
</html>
